<?php
/** @var \Josequal\ImportExport\Block\Adminhtml\Categories\Index $block */
?>
<div class="josequal-import-export">
    <div class="page-main-actions">
        <div class="page-actions">
            <button type="button" class="action-primary" onclick="showImportForm()">
                <span><?= $block->escapeHtml(__('Import Categories')) ?></span>
            </button>
            <button type="button" class="action-secondary export-btn" onclick="exportCategories()">
                <span><?= $block->escapeHtml(__('Export Categories')) ?></span>
            </button>
        </div>
    </div>

    <!-- Import Form -->
    <div class="import-export-form" id="import-form-container" style="display: none;">
        <h2><?= $block->escapeHtml(__('Import Categories')) ?></h2>
        <form id="import-form" action="<?= $block->escapeUrl($block->getImportUrl()) ?>" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="import_file"><?= $block->escapeHtml(__('Select File')) ?></label>
                <div class="upload-area" onclick="document.getElementById('import_file').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text"><?= $block->escapeHtml(__('Click to select file or drag & drop')) ?></div>
                    <div class="upload-hint"><?= $block->escapeHtml(__('Supported formats: CSV, XLSX')) ?></div>
                </div>
                <input type="file" id="import_file" name="import_file" accept=".csv,.xlsx" style="display: none;" required>
            </div>

            <div class="form-group">
                <label for="update_existing"><?= $block->escapeHtml(__('Update Existing Categories')) ?></label>
                <select id="update_existing" name="update_existing">
                    <option value="0"><?= $block->escapeHtml(__('No')) ?></option>
                    <option value="1"><?= $block->escapeHtml(__('Yes')) ?></option>
                </select>
            </div>

            <div class="form-group">
                <button type="submit" class="action-primary">
                    <span><?= $block->escapeHtml(__('Start Import')) ?></span>
                </button>
                <button type="button" class="action-secondary" onclick="hideImportForm()">
                    <span><?= $block->escapeHtml(__('Cancel')) ?></span>
                </button>
            </div>
        </form>

        <div class="progress-bar" style="display: none;">
            <div class="progress-fill" style="width: 0%;"></div>
        </div>

        <div class="sample-download">
            <p><?= $block->escapeHtml(__('Download sample CSV file:')) ?></p>
            <a href="<?= $block->escapeUrl($block->getSampleCsvUrl()) ?>" class="action-secondary">
                <?= $block->escapeHtml(__('Download Sample CSV')) ?>
            </a>
        </div>
    </div>

    <!-- Export Form -->
    <div class="import-export-form" id="export-form-container" style="display: none;">
        <h2><?= $block->escapeHtml(__('Export Categories')) ?></h2>
        <form id="export-form">
            <div class="form-group">
                <label for="export_format"><?= $block->escapeHtml(__('Export Format')) ?></label>
                <select id="export_format" name="export_format">
                    <option value="csv">CSV</option>
                    <option value="xlsx">XLSX</option>
                </select>
            </div>

            <div class="form-group">
                <label for="export_fields"><?= $block->escapeHtml(__('Fields to Export')) ?></label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="export_fields[]" value="category_id" checked> <?= $block->escapeHtml(__('Category ID')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="parent_id" checked> <?= $block->escapeHtml(__('Parent Category ID')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="name" checked> <?= $block->escapeHtml(__('Name')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="description" checked> <?= $block->escapeHtml(__('Description')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="is_active" checked> <?= $block->escapeHtml(__('Is Active')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="position" checked> <?= $block->escapeHtml(__('Position')) ?></label>
                    <label><input type="checkbox" name="export_fields[]" value="url_key" checked> <?= $block->escapeHtml(__('URL Key')) ?></label>
                </div>
            </div>

            <div class="form-group">
                <button type="button" class="action-primary export-btn" onclick="startExport()">
                    <span><?= $block->escapeHtml(__('Start Export')) ?></span>
                </button>
                <button type="button" class="action-secondary" onclick="hideExportForm()">
                    <span><?= $block->escapeHtml(__('Cancel')) ?></span>
                </button>
            </div>
        </form>

        <div class="progress-bar" style="display: none;">
            <div class="progress-fill" style="width: 0%;"></div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="import-export-form">
        <h2><?= $block->escapeHtml(__('Instructions')) ?></h2>
        <div class="instructions-content">
            <h3><?= $block->escapeHtml(__('Required Fields:')) ?></h3>
            <ul>
                <li><strong>Category ID:</strong> <?= $block->escapeHtml(__('Category ID (leave empty for new categories)')) ?></li>
                <li><strong>Name:</strong> <?= $block->escapeHtml(__('Category name')) ?></li>
                <li><strong>Parent ID:</strong> <?= $block->escapeHtml(__('Parent category ID (0 for root categories)')) ?></li>
            </ul>

            <h3><?= $block->escapeHtml(__('Optional Fields:')) ?></h3>
            <ul>
                <li><strong>Description:</strong> <?= $block->escapeHtml(__('Category description')) ?></li>
                <li><strong>Is Active:</strong> <?= $block->escapeHtml(__('1 = Active, 0 = Inactive')) ?></li>
                <li><strong>Position:</strong> <?= $block->escapeHtml(__('Display position (numeric)')) ?></li>
                <li><strong>URL Key:</strong> <?= $block->escapeHtml(__('URL identifier (auto-generated if empty)')) ?></li>
            </ul>
        </div>
    </div>
</div>

<script>
function showImportForm() {
    document.getElementById('import-form-container').style.display = 'block';
    document.getElementById('export-form-container').style.display = 'none';
}

function hideImportForm() {
    document.getElementById('import-form-container').style.display = 'none';
}

function showExportForm() {
    document.getElementById('export-form-container').style.display = 'block';
    document.getElementById('import-form-container').style.display = 'none';
}

function hideExportForm() {
    document.getElementById('export-form-container').style.display = 'none';
}

function exportCategories() {
    showExportForm();
}

function startExport() {
    var format = document.getElementById('export_format').value;
    var url = '<?= $block->escapeUrl($block->getExportUrl()) ?>?format=' + format;
    window.location.href = url;
}
</script>
